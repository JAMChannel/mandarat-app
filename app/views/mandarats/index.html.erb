<div class="mandarat">
  <div class="mandarat-main">
    <section class="pb-4">
      <section class="w-100 p-4 text-center">
        <table class="table table-borderless">
          <tbody>
            <tr>
              <td>
                <button 
                    type="button" 
                    class="mandarat-main-button" 
                    data-mdb-toggle="modal" 
                    data-mdb-target="#staticBackdrop" style="">
                  <%= @mandarat[0].name %>
                  <% @item = @mandarat[0].id%>
                </button>
                <%= render 'template/modalmandaratnew'%>
                <%# end %>
              </td>
              <!-- <th scope="row">1</th> -->
              <td>
                <button 
                    type="button" 
                    class="mandarat-main-button" 
                    data-mdb-toggle="modal" 
                    data-mdb-target="#staticBackdrop1" style="">
                  <%= @mandarat[1].name %>
                  <% @item1 = @mandarat[1].id%>
                </button>
                <%= render 'template/modalmandaratnew1'%>
              </td>
              <td>
                <button 
                    type="button" 
                    class="mandarat-main-button" 
                    data-mdb-toggle="modal" 
                    data-mdb-target="#staticBackdrop2" style="">
                  <%= @mandarat[2].name %>
                  <% @item2 = @mandarat[2].id%>
                </button>
                <%= render 'template/modalmandaratnew2'%>
              </td>
            </tr>
            <tr>
              <td>
                <button 
                    type="button" 
                    class="mandarat-main-button" 
                    data-mdb-toggle="modal" 
                    data-mdb-target="#staticBackdrop3" style="">
                  <%= @mandarat[3].name %>
                  <% @item3 = @mandarat[3].id%>
                  <%# binding.pry %>
                </button>
                <%= render 'template/modalmandaratnew3'%>
              </td>
              <td>
                <div class="mandarat-main-button">
                  <%= @title.title %>
                </div>
              </td>
              <td>
                <button 
                    type="button" 
                    class="mandarat-main-button" 
                    data-mdb-toggle="modal" 
                    data-mdb-target="#staticBackdrop4" style="">
                  <%= @mandarat[4].name %>
                  <% @item4 = @mandarat[4].id%>
                </button>
                <%= render 'template/modalmandaratnew4'%>
              </td>
            </tr>
            <tr>
              <td>
                <button 
                    type="button" 
                    class="mandarat-main-button" 
                    data-mdb-toggle="modal" 
                    data-mdb-target="#staticBackdrop5" style="">
                  <%= @mandarat[5].name %>
                  <% @item5 = @mandarat[5].id%>
                </button>
                <%= render 'template/modalmandaratnew5'%>
              </td>
              <td>
                <button 
                    type="button" 
                    class="mandarat-main-button" 
                    data-mdb-toggle="modal" 
                    data-mdb-target="#staticBackdrop6" style="">
                  <%= @mandarat[6].name %>
                  <% @item6 = @mandarat[6].id%>
                </button>
                <%= render 'template/modalmandaratnew6'%>
              </td>
              <td>
                <button 
                    type="button" 
                    class="mandarat-main-button" 
                    data-mdb-toggle="modal" 
                    data-mdb-target="#staticBackdrop7" style="">
                  <%= @mandarat[7].name %>
                  <% @item7 = @mandarat[7].id%>
                </button>
                <%= render 'template/modalmandaratnew7'%>
              </td>
            </tr>
          </tbody>
        </table>
      </section>
      <div class="p-4 text-center">
        <%= link_to logout_path, method: :delete, data: {confirm: "ログアウトしますか？"} ,class:"btn btn-link px-3",style:"color: black;"  do %>
          <i class="fas fa-code me-md-2"></i><span class="d-none d-md-inline-block export-to-snippet pe-none">ログアウト</span>
        <% end %>
        <button  class="drawer-toggle btn btn-link px-3" style="color: black;">
          <i class="fas fa-bars me-md-2"></i><span class="d-none d-md-inline-block export-to-snippet pe-none">navbar</span>
        </button>
        <%= render 'template/modallsideber'%>
      </div>
    </section>
  </div>
  <div class="mandarat-font">
    <canvas id="myCanvas"></canvas>
  </div>
</div>

<script>
  window.addEventListener('load', Resize);
  window.addEventListener('resize', Resize);
  
  // let width = 100, height = 100;

  function getRandomArbitrary(min, max) {
    return Math.random() * (max - min) + min;
  }


  function Resize() {

    let width = window.innerWidth,
        height = window.innerHeight;

    /**
    * renderer
    **/
    let renderer = new THREE.WebGLRenderer({
                      canvas: document.getElementById('myCanvas'),
                      alpha: true
                   });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(width, height);

    /**
    * scene
    **/
    let scene = new THREE.Scene();

    /**
    * camera
    **/
    let camera = new THREE.PerspectiveCamera(45, width / height);
    camera.position.set(0, 0, 1000);

    /**
    * controls
    **/
    // let controls = new THREE.OrbitControls(
    //                    camera,
    //                    document.querySelector('#myCanvas')
    //                );

    /**
    * BoxGeometry
    **/
    let circle_size = 1400;
    let circle = new THREE.BoxGeometry(
                          circle_size,
                          circle_size,
                          circle_size
                        );
    let circle_mat = new THREE.MeshPhongMaterial( {
                          transparent: true,
                          opacity: 0.1,
                          color: 0x000000
                        } );

    circle_box = new THREE.Mesh(circle, circle_mat);
    circle_box.position.x = 0;
    scene.add(circle_box);

    /**
    * texts
    **/
    let loader = new THREE.FontLoader();
    loader.load( 'https://threejs-plactice.vercel.app/fontloader/fonts/helvetiker_regular.typeface.json', function ( font ) {
      let matDark = new THREE.LineBasicMaterial( {
        color: 0x000000,
        opacity: .7,
        side: THREE.DoubleSide
      } );
      let matLite = new THREE.MeshBasicMaterial( {
        color: 0x000000,
        transparent: true,
        opacity: .7,
        side: THREE.DoubleSide
      } );

      for (let i = 0; i < 120; i++) {
        let message = ['html','css','Javascript','php','jQuery','vue.js','React.js','node.js','gulp.js','SCSS','Wordpress','Movable type','micro cms','typescript', 'go', 'nuxt.js', 'next.js'],
            christalNo = Math.floor( Math.random() * message.length),
            shapes = font.generateShapes( message[christalNo], 30 ),
            text_geometry = new THREE.ShapeGeometry( shapes ),
            size = 1000;
        
        text_geometry.computeBoundingBox();

        switch (true) {
          case ( i % 8 == 0 ):
            xcode = getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            ycode = getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            zcode = getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
          break;
          case ( i % 8 == 1 ):
            xcode = -getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            ycode = getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            zcode = getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
          break;
          case ( i % 8 == 2 ):
            xcode = getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            ycode = -getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            zcode = getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
          break;
          case ( i % 8 == 3 ):
            xcode = getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            ycode = getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            zcode = -getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
          break;
          case ( i % 8 == 4 ):
            xcode = -getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            ycode = getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            zcode = -getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
          break;
          case ( i % 8 == 5 ):
            xcode = getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            ycode = -getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            zcode = -getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
          break;
          case ( i % 8 == 6 ):
            xcode = -getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            ycode = -getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            zcode = getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
          break;
          default:
            xcode = -getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            ycode = -getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );
            zcode = -getRandomArbitrary( circle_size / 1.5, -circle_size / 1.5 );              
          break;
        }

        text_geometry.translate(
          xcode,
          ycode,
          zcode,
        );

        let text = new THREE.Mesh( text_geometry, matLite );
            text.position.z = -5;
            scene.add( text );

            let holeShapes = [];

            for ( let i = 0; i < shapes.length; i ++ ) {
              let shape = shapes[ i ];
              if ( shape.holes && shape.holes.length > 0 ) {
                for ( let j = 0; j < shape.holes.length; j ++ ) {
                  let hole = shape.holes[ j ];
                  holeShapes.push( hole );
                }
              }
            }
            shapes.push.apply( shapes, holeShapes );
            let lineText = new THREE.Object3D();
            for ( let i = 0; i < shapes.length; i ++ ) {
              let shape = shapes[ i ],
                  points = shape.getPoints(),
                  text_geometry = new THREE.BufferGeometry().setFromPoints( points );

              text_geometry.translate(
                xcode,
                ycode,
                zcode
              );
              let lineMesh = new THREE.Line( text_geometry, matDark );
              lineText.add( lineMesh );
            }
            scene.add( lineText );
        }
    } );

    tick();

    function tick() {
      scene.rotation.x += 0.005;
      scene.rotation.y += 0.005;
      scene.rotation.z += 0.005;
      renderer.render(scene, camera);
      requestAnimationFrame(tick);
    }
  }
</script>



